{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\resources\\resources\\scriptes/assets\\resources\\resources\\scriptes\\Hall.js"],"names":["NetWorkManager","require","CreatorHelper","Users","cc","Class","extends","Component","properties","headSprite","Sprite","playerName","Label","playerId","fangkaNum","createRoomBn","Node","enterRoomBn","createConfirm","juNumGroup","waitingPfb","Prefab","onLoad","self","setNodeClickEvent","log","custom","idx","children","toggle","getComponent","Toggle","isChecked","juNum","parseInt","node","name","onConnectedToHall","hallService","proxy","createRoom","data","ok","suc","connectAndAuthToGame","account","pass","url","onConnectedToGame","loginData","loginToGameData","isInGame","director","loadScene","clearGameService","clickCount","clearInput","num","numUi","find","toString","shownumUi","numLab","string","inputnumUi","evt","clickNum","tabNumStr","joinTable","reinputUi","deleteUi","numlab","onClose","bg","instantiate","addChild","removeFromParent","onClosedFromHall","bind","tableId","gameUrl","start","getPlayerBaseInfo","baseInfo","info","nickName","id","score","headimgurl","headimgUrl","changeSpriteFrameWithServerUrl"],"mappings":"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","file":"Hall.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\resources\\resources\\scriptes","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\n// Learn Attribute:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\n\nvar NetWorkManager = require(\"NetWorkManager\");\nvar CreatorHelper = require(\"CreatorHelper\");\nvar Users = require(\"Users\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        headSprite:cc.Sprite,//头像图片\n        playerName:cc.Label,//玩家名字\n        playerId:cc.Label,//玩家id\n        fangkaNum:cc.Label,//房卡数量\n        createRoomBn:cc.Node,//创建房间按钮\n        enterRoomBn:cc.Node,//加入房间按钮\n        createConfirm:cc.Node,\n        juNumGroup:cc.Node,\n        waitingPfb:cc.Prefab\n\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        var self = this;\n        CreatorHelper.setNodeClickEvent(this.createConfirm,function(){\n            cc.log(\"点击创建！！！\");\n            var custom = {};\n            for(var idx in self.juNumGroup.children){\n                var toggle = self.juNumGroup.children[idx].getComponent(cc.Toggle);\n                if(toggle.isChecked){\n                    custom.juNum = parseInt(toggle.node.name);\n                    break;\n                }\n            }\n            \n            NetWorkManager.onConnectedToHall(function (hallService) {\n                hallService.proxy.createRoom(custom,function (data) {\n                    cc.log(\"创建房间！！！\");cc.log(data);\n                    if(data.ok && data.suc){\n                        NetWorkManager.connectAndAuthToGame(Users.account,Users.pass,data.url);\n                        NetWorkManager.onConnectedToGame(function () {\n                            var loginData = Users.loginToGameData;\n                            if(loginData.isInGame){\n                                cc.director.loadScene(\"game\");\n                            }else{\n                                NetWorkManager.clearGameService();\n                            }\n                        })\n                    }else{\n\n                    }\n                });\n            });\n        });\n        //-------------------------------加入房价--------------------------------------------------\n        var self = this;\n        this.clickCount = 0;\n        var clearInput = function () {\n            for(var num=0;num<=5;num++){\n                var numUi = cc.find(num.toString(),self.shownumUi);\n                var numLab = cc.find(\"txt\",numUi).getComponent(cc.Label);\n                numLab.string = \"\";\n            }\n            self.clickCount = 0;\n        }\n        this.shownumUi = cc.find(\"joinroot/joinbg/shownums\",this.node);\n        CreatorHelper.setNodeClickEvent(this.enterRoomBn,function () {\n            clearInput();\n        }); \n        this.inputnumUi = cc.find(\"joinroot/joinbg/inputnums\",this.node);\n            for(var num=0;num<=9;num++){\n                var numUi = cc.find(num.toString(),this.inputnumUi);\n                CreatorHelper.setNodeClickEvent(numUi,function (evt) {\n                    if(self.clickCount<6){\n                        var clickNum = evt.name;\n                        var numUi = cc.find(self.clickCount.toString(),self.shownumUi);\n                        var numLab = cc.find(\"txt\",numUi).getComponent(cc.Label);\n                        numLab.string = clickNum;\n                        self.clickCount++; \n                    }else{\n                        if(self.clickCount===6){\n                            var tabNumStr = \"\";\n                            for(var idx=0;idx<=5;idx++){\n                                var numUi = cc.find(idx.toString(),self.shownumUi);\n                                var numLab = cc.find(\"txt\",numUi).getComponent(cc.Label);\n                                tabNumStr+=numLab.string;\n                            }\n                            cc.log(tabNumStr);\n                            self.joinTable(tabNumStr);\n                        }\n                    }\n                }); \n        }\n        var reinputUi = cc.find(\"reinput\",this.inputnumUi);\n        var deleteUi = cc.find(\"delete\",this.inputnumUi);\n        CreatorHelper.setNodeClickEvent(reinputUi,function (evt) {\n            clearInput();\n        }); \n        CreatorHelper.setNodeClickEvent(deleteUi,function (evt) {\n            if(self.clickCount == 0)return;\n            self.clickCount--;\n            var numUi = cc.find(self.clickCount.toString(),self.shownumUi);\n            var numlab = cc.find(\"txt\",numUi).getComponent(cc.Label);\n            numlab.string = '';\n        }); \n        //------------------------daunxianjiemian \n        this.onClose = function () {\n            var bg = cc.instantiate(this.waitingPfb);\n            this.node.addChild(bg); \n            NetWorkManager.onConnectedToHall(function () {\n                bg.removeFromParent(true);\n            });\n        }\n        NetWorkManager.onClosedFromHall(this.onClose.bind(this));\n        \n    },\n    joinTable(tableId){\n        NetWorkManager.onConnectedToHall(function (hallService) {\n            hallService.proxy.joinTable(tableId,function (data) {\n                cc.log(\"加入房间结果！！！\");cc.log(data);\n                if(data.ok && data.suc){\n                    NetWorkManager.connectAndAuthToGame(Users.account,Users.pass,data.gameUrl);\n                    NetWorkManager.onConnectedToGame(function () {\n                        var loginData = Users.loginToGameData;\n                        //var loginDataInfo = JSON.stringify(loginData);\n                        //cc.log(\"loginData: \"+loginDataInfo.inRoomInfo);\n                        if(loginData.isInGame){\n                            cc.director.loadScene(\"game\");\n                            cc.log(data.gameUrl);\n                            //NetWorkManager.offClosedFromHall(this.onClose.bind(this));\n                            //NetWorkManager.clearHallService();\n                        }else{\n                            NetWorkManager.clearGameService();\n                        }\n                    })\n                }else{\n                    cc.log('加入失败哦');\n                }\n            });\n        });\n    },\n    start () {\n        var self = this;\n        NetWorkManager.onConnectedToHall(function (hallService) {\n            hallService.proxy.getPlayerBaseInfo(function (data) {\n                if(data.ok && data.suc){//获取信息成功\n                     var baseInfo = data.info;\n                     self.playerName.string = baseInfo.nickName;\n                     self.playerId.string = baseInfo.id;\n                     self.fangkaNum.string = baseInfo.score;\n                     /*var frame = new cc.SpriteFrame();\n                     frame.setTexture(baseInfo.headimgUrl);\n                     self.headSprite.spriteFrame = frame;*/\n                     var headimgurl = baseInfo.headimgUrl;\n                     //头像\n                     CreatorHelper.changeSpriteFrameWithServerUrl(self.headSprite,headimgurl);\n                }else{//获取信息失败,提示用户\n\n                }\n            });\n        })\n    },\n    // update (dt) {},\n});"]}