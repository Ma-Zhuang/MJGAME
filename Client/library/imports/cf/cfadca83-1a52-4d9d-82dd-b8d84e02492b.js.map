{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\resources\\resources\\modules/assets\\resources\\resources\\modules\\NetWorkManager.js"],"names":["AutoReconnectWsRpcClient","require","Users","EventEmitter","Handler","NetWorkManager","account","pass","url","g_HallService","connect","cc","log","onClose","g_HallServiceIsLogin","events","emit","connectAndAuthToHall","onReady","service","proxy","login","data","ok","suc","nickName","info","nickname","headUrl","headimgurl","fangka","score","sex","loginToHallData","cb","on","off","clear","g_GameService","addRpc","g_GameServiceIsLogin","gameEvents","connectAndAuthToGame","loginToGameData","codes","code","hallUrl","onConnectedToHall","isInGame","gameUrl","onConnectedToGame","loginData","director","loadScene","clearGameService","module","exports"],"mappings":"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","file":"NetWorkManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\resources\\resources\\modules","sourcesContent":["/**\n * Created by litengfei on 2018/1/18.\n */\nvar AutoReconnectWsRpcClient = require(\"AutoReconnectWsRpcClient\");\nvar Users = require(\"Users\");\nvar EventEmitter = require(\"EventEmitter\");\nvar Handler = require('Handler');\nclass NetWorkManager{\n    static connectAndAuthToHall(account,pass,url) {//cb 2params baseinfo service\n        if (NetWorkManager.g_HallService === null) {\n            NetWorkManager.g_HallService = new AutoReconnectWsRpcClient();\n            NetWorkManager.g_HallService.connect(url);\n            cc.log('login');\n            NetWorkManager.g_HallService.onClose(function () {\n                //连接中断\n                NetWorkManager.g_HallServiceIsLogin = false;\n                NetWorkManager.events.emit(\"closeFromHall\");\n                NetWorkManager.connectAndAuthToHall(account,pass,url);\n            })\n        }\n        NetWorkManager.g_HallService.onReady(function (service) {\n            service.proxy.login(account,pass,function (data) {\n                if(data.ok&&data.suc){\n                    NetWorkManager.g_HallServiceIsLogin = true;\n                    Users.account = account;\n                    Users.pass = pass;\n                    Users.nickName = data.info.nickname;\n                    Users.headUrl = data.info.headimgurl;\n                    Users.fangka = data.info.score;\n                    Users.sex = data.info.sex;\n                    Users.loginToHallData = data.info;\n                    cc.log('info: '+data.info);\n                    NetWorkManager.events.emit(\"loginToHall\",service);\n                }\n            })\n        })\n    }\n\n    static onConnectedToHall(cb){//cb 1param service\n        if(NetWorkManager.g_HallServiceIsLogin){\n            cb(NetWorkManager.g_HallService);\n            return;\n        }\n        NetWorkManager.events.on(\"loginToHall\",cb);\n        cc.log('ceshi');\n    }\n\n    static offConnectedToHall(cb){\n        NetWorkManager.events.off(cb);\n    }\n\n    static onClosedFromHall(cb){//cb 1param service\n        NetWorkManager.events.on(\"closeFromHall\",cb);\n    }\n\n    static  offClosedFromHall(cb){\n        NetWorkManager.events.off(cb);\n    }\n\n    static clearHallService() {//清理当前大厅的连接\n        NetWorkManager.events = new EventEmitter();\n        NetWorkManager.g_HallServiceIsLogin = false;\n        if (NetWorkManager.g_HallService) NetWorkManager.g_HallService.clear();\n    }\n\n\n\n\n    static connectAndAuthToGame(account,pass,url) {//cb 2params baseinfo service\n        if (NetWorkManager.g_GameService === null) {\n            NetWorkManager.g_GameService = new AutoReconnectWsRpcClient();\n            NetWorkManager.g_GameService.addRpc(Handler.service); \n            NetWorkManager.g_GameService.connect(url);\n            NetWorkManager.g_GameService.onClose(function () {\n                //连接中断\n                NetWorkManager.g_GameServiceIsLogin = false;\n                NetWorkManager.gameEvents.emit(\"closeFromGame\");\n                NetWorkManager.connectAndAuthToGame(account,pass,url);\n            })\n        }\n        NetWorkManager.g_GameService.onReady(function (service) {\n            service.proxy.login(account,pass,function (data) {\n                if(data.ok&&data.suc){\n                    cc.log('登陆游戏服务器成功：');\n                    cc.log(data);\n                    NetWorkManager.g_GameServiceIsLogin = true;\n                    Users.account = account;\n                    Users.pass = pass;\n                    Users.nickName = data.info.nickname;\n                    Users.headUrl = data.info.headimgurl;\n                    Users.fangka = data.info.score;\n                    Users.sex = data.info.sex;\n                    Users.loginToGameData = data;\n                    NetWorkManager.gameEvents.emit(\"loginToGame\",service);\n                }else {\n                    if(data.codes.code == 1000){\n                        NetWorkManager.connectAndAuthToHall(account,pass,Users.hallUrl);\n                        NetWorkManager.onConnectedToHall(function () {\n                            if(Users.loginToHallData.isInGame){//跳转到游戏界面\n                                NetWorkManager.connectAndAuthToGame(Users.account,Users.pass,Users.loginToHallData.gameUrl);\n                                NetWorkManager.onConnectedToGame(function () {\n                                    var loginData = Users.loginToGameData;\n                                    if(loginData.isInGame){\n                                        cc.director.loadScene(\"game\");\n                                    }else{\n                                        NetWorkManager.clearGameService();\n                                    }\n                                });\n                            }else{\n                                cc.director.loadScene(\"hall\");\n                            }\n                        });\n                    }\n                }\n            });\n        });\n    }\n\n    static onConnectedToGame(cb){//cb 1param service\n        if(NetWorkManager.g_GameServiceIsLogin){\n            cb(NetWorkManager.g_GameService);\n            return;\n        }\n        NetWorkManager.gameEvents.on(\"loginToGame\",cb);\n    }\n\n    static offConnectedToGame(cb){\n        NetWorkManager.gameEvents.off(cb);\n    }\n\n    static onClosedFromGame(cb){//cb 1param service\n        NetWorkManager.gameEvents.on(\"closeFromGame\",cb);\n    }\n\n    static  offClosedFromGame(cb){\n        NetWorkManager.gameEvents.off(cb);\n    }\n\n    static clearGameService() {//清理当前大厅的连接\n        NetWorkManager.gameEvents = new EventEmitter();\n        NetWorkManager.g_GameServiceIsLogin = false;\n        if (NetWorkManager.g_GameService){\n            NetWorkManager.g_GameService.clear();\n            NetWorkManager.g_GameService = null;\n        }\n    } \n\n}\nNetWorkManager.g_HallService = null;\nNetWorkManager.g_HallServiceIsLogin = false;\nNetWorkManager.events = new EventEmitter();\n\nNetWorkManager.g_GameService = null;\nNetWorkManager.g_GameServiceIsLogin = false;\nNetWorkManager.gameEvents = new EventEmitter();\nmodule.exports = NetWorkManager;"]}