{"version":3,"sources":["GameLogic.js"],"names":["CreatorHelper","require","UnitTools","User","Handler","Majiang","NetWorkManager","HandAction","Peng","AnGang","GuoluGang","MingGang","Dinapao","Zimo","cc","Class","extends","Component","properties","handCardsPfb","default","type","Prefab","hitCardsPfb","gangpengPfb","actionSelectPfb","actionImages","SpriteFrame","actionSplashPfb","splashImages","cardImages","SpriteAtlas","gameScorePfb","scoreItemPfb","scorebqPfb","cardhuPfb","titleMask","finalScorePfb","finalScoreItemPfb","finScoreDetailPfb","waitingPfb","onLoad","posCount","selfPos","headRoot","headSpUi","nameUi","scoreUi","raceScore","pos","find","node","handCardsUi","hitCardUi","TrunTime","selectActionUi","gangpengCardsUi","gangpengCardsUiBottom","splashUi","pInfos","instance","logicCom","handCardsPos","createHandCardPos","hitCardsPos","createHitCardPos","gangpengCardsPos","createGangPengCardPos","splashPos","createSplashPos","isRestore","selfHandCard","Array","hitCards","i","handCards","clearToStart","onClose","bg","instantiate","addChild","onConnectedToGame","removeFromParent","onClosedFromGame","bind","active","getComponent","Label","string","cards","fill","clearToContinue","removeAllChildren","destroyAllChildren","posArray","startPos","x","y","offset","lastOffset","cardPos","index","position","config","lineOffset","line","parseInt","lineIndex","gangpengPos","positions","push","creatHandCardsUi","cardIndex","pfb","cardUi","sp","getSpriteFrame","smCard","Sprite","spriteFrame","createHitCardsUi","preStr","createGangPengCardUi","gangpengUi","children","length","card","addGangPengCardUi","count","idx","ui","meta","tIndex","addHitCardUi","Object","keys","zIndex","addSplashUi","map","Animation","on","getScreenPos","selfLogicPos","logicPos","myPos","delta","Number","screenPos","showHead","pId","scrPos","imgUrl","name","nameLab","changeSpriteFrameWithServerUrl","info","getOrCreateJsonInJson","hideHead","isNullOrUndefined","adjustSelfHandCard","cardCount","adjustHandCard","startIndex","touchCard","scrpos","handCars","log","bindCardEvt","removeHandCardAndAdjust","cardIndexs","turn","srcPos","time","timeSche","unschedule","rotations","getChildByName","rotation","schedule","hitCard","self","popUp","setNodeClickEvent","client","data","actionId","proxy","cIdx","showActionSelectUi","actions","selectAction","actionType","passUi","action","details","detail","selectUi","handledoAction","hitPos","hitIndex","hitScrPos","hitUi","uis","handlehu","posHuType","scheduleOnce","showGameScore","zhuangPos","paoPos","score","posName","huCardIndex","posHandCards","posActionCards","huPosAndType","posScore","posNames","addStyle","styleRoot","styleName","biaoqianNode","nameNode","titleNode","scoreItemsNode","scoreItem","zhuangNode","scoreNode","huMaskNode","styleNode","huType","actionTimes","addActionTime","actionCards","cardStartX","cardOffset","pengOffset","gangOffset","huCardOffset","mjrootNode","acards","scale","hbqUi","aTimeNode","aTimeName","aTimes","aType","aTName","aTime","goonbn","ready","showFinalScore","posScores","posNameAndHeadUrl","finalScoreUi","detailsUi","scores","headUrl","scoreItemUi","headSp","allScore","scoresUi","showRoomId","roomId","roomIdLab","normalStart","inRoomInfo","loginToGameData","heads","playerId","forEach","pInfo","headimgUrl","nickName","frames","frame","eventName","start","test","randomIndex","random","update","dt","eventQueue","onDestroy","offClosedFromGame","clearGameService"],"mappings":"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","file":"GameLogic.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\resources\\resources\\scriptes","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nvar CreatorHelper = require('CreatorHelper');\r\nvar UnitTools = require('UnitTools');\r\nvar User = require('Users');\r\nvar Handler = require('Handler');\r\nvar Majiang = require('Chess').Majiang;\r\nvar NetWorkManager = require('NetWorkManager');\r\nvar HandAction = {\r\n    Peng:1,\r\n    AnGang:2,\r\n    GuoluGang:3,\r\n    MingGang:4,\r\n    Dinapao:5,\r\n    Zimo:6\r\n};\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        handCardsPfb:{\r\n            default:[],\r\n            type:cc.Prefab\r\n        },\r\n        hitCardsPfb:{\r\n            default:[],\r\n            type:cc.Prefab\r\n        },\r\n        gangpengPfb:{\r\n            default:[],\r\n            type:cc.Prefab\r\n        },\r\n        actionSelectPfb:cc.Prefab,\r\n        actionImages:{\r\n            default:[],\r\n            type:cc.SpriteFrame\r\n        },\r\n        actionSplashPfb:cc.Prefab,\r\n        splashImages:{\r\n            default:[],\r\n            type:cc.SpriteFrame\r\n        },\r\n        cardImages:cc.SpriteAtlas,\r\n        gameScorePfb:cc.Prefab,\r\n        scoreItemPfb:cc.Prefab,\r\n        scorebqPfb:cc.Prefab,//标签Perfab\r\n        cardhuPfb:cc.Prefab,//最后胡牌的标签\r\n        titleMask:{//最后胡牌的表数据\r\n            default:[],\r\n            type:cc.SpriteFrame\r\n        },\r\n        finalScorePfb:cc.Prefab,\r\n        finalScoreItemPfb:cc.Prefab,\r\n        finScoreDetailPfb:cc.Prefab,\r\n        waitingPfb:cc.Prefab\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.posCount = 4;\r\n        this.selfPos = 2;\r\n        this.headRoot = {};\r\n        this.headSpUi = {};\r\n        this.nameUi = {};\r\n        this.scoreUi = {};\r\n        this.raceScore = null;//服务器发送的最终数据\r\n        for(var pos = 0; pos<this.posCount; pos++){\r\n            this.headRoot[pos] = cc.find('headwig'+pos+'/head',this.node);\r\n            this.headSpUi[pos] = cc.find('headwig'+pos+'/head/headframe/head',this.node);\r\n            this.nameUi[pos] = cc.find('headwig'+pos+'/head/name',this.node);\r\n            this.scoreUi[pos] = cc.find('headwig'+pos+'/head/score',this.node);\r\n        }\r\n\r\n        this.handCardsUi = cc.find('handcards',this.node);\r\n        this.hitCardUi = cc.find('hitcards',this.node);\r\n        this.TrunTime = cc.find('turntime',this.node);\r\n        this.selectActionUi = cc.find('actionselectui',this.node);\r\n        this.gangpengCardsUi = cc.find('gangpengcards',this.node);\r\n        this.gangpengCardsUiBottom = cc.find('gangpengcardsbottom',this.node);\r\n        this.splashUi = cc.find('splashs',this.node);\r\n\r\n        this.pInfos = {};//保存玩家信息\r\n        \r\n        Handler.instance().logicCom = this;\r\n        this.handCardsPos = this.createHandCardPos();\r\n        this.hitCardsPos = this.createHitCardPos();\r\n        this.gangpengCardsPos = this.createGangPengCardPos();\r\n        this.splashPos = this.createSplashPos();\r\n        this.isRestore = false//是否是在短线重连中  \r\n\r\n        this.selfHandCard = new Array(34);\r\n        this.hitCards = {};\r\n        for(var i=0;i<34;i++){\r\n            this.selfHandCard[i]={};\r\n        }\r\n\r\n        this.handCards = new Array(this.posCount);\r\n\r\n        \r\n        this.clearToStart();\r\n\r\n        this.onClose = function () {\r\n            var bg = cc.instantiate(this.waitingPfb);\r\n            this.node.addChild(bg); \r\n            NetWorkManager.onConnectedToGame(function () {\r\n                bg.removeFromParent(true);\r\n            });\r\n        }\r\n        NetWorkManager.onClosedFromGame(this.onClose.bind(this));\r\n    },\r\n    clearToStart(){\r\n        for(var pos = 0; pos<this.posCount; pos++){\r\n            this.headRoot[pos].active = false;\r\n            this.nameUi[pos].getComponent(cc.Label).string = '';\r\n            this.scoreUi[pos].getComponent(cc.Label).string = '';\r\n            this.hitCards[pos] ={};\r\n            var cards = this.handCards[pos] = new Array(14);\r\n            cards.fill(null);\r\n        }\r\n    },\r\n    clearToContinue(){\r\n        this.handCardsUi.removeAllChildren(true);\r\n        this.handCardsUi.destroyAllChildren();\r\n        this.hitCardUi.removeAllChildren(true);\r\n        this.hitCardUi.destroyAllChildren();\r\n        this.gangpengCardsUi.removeAllChildren(true);\r\n        this.gangpengCardsUi.destroyAllChildren();\r\n        this.selectActionUi.removeAllChildren(true);\r\n        this.selectActionUi.destroyAllChildren();\r\n        this.gangpengCardsUiBottom.removeAllChildren(true);\r\n        this.gangpengCardsUiBottom.destroyAllChildren();\r\n        \r\n\r\n        this.TrunTime.active = false;\r\n\r\n        this.selfHandCard = new Array(34);\r\n        this.hitCards = {};\r\n        for(var i=0;i<34;i++){\r\n            this.selfHandCard[i]={};\r\n        }\r\n        this.handCards = new Array(this.posCount);\r\n        for(var pos = 0; pos<this.posCount; pos++){\r\n            this.hitCards[pos] ={};\r\n            var cards = this.handCards[pos] = new Array(14);\r\n            cards.fill(null);\r\n        }\r\n    },\r\n    createHandCardPos(){//创建所有手里牌的位置\r\n        var posArray = new Array(this.posCount);\r\n        posArray[0] = {startPos:{x:254,y:208},offset:{x:-40,y:0},lastOffset:{x:-20,y:0}};\r\n        posArray[1] = {startPos:{x:-387,y:263},offset:{x:0,y:-29},lastOffset:{x:0,y:-35}};\r\n        posArray[2] = {startPos:{x:-576,y:-347},offset:{x:81.5,y:0},lastOffset:{x:20,y:0}};\r\n        posArray[3] = {startPos:{x:416,y:-191},offset:{x:0,y:29},lastOffset:{x:0,y:35}};\r\n\r\n        var handCardsPos = new Array(this.posCount);\r\n        for(var pos=0;pos<this.posCount;pos++){\r\n            var cardPos = new Array(14);\r\n            handCardsPos[pos] = cardPos;\r\n            for(var index=0;index<14;index++){\r\n                var position = cardPos[index] = {};\r\n                var config = posArray[pos];\r\n                position.x = config.startPos.x + index * config.offset.x;\r\n                position.y = config.startPos.y + index * config.offset.y;\r\n                if(index==13){\r\n                    position.x+=config.lastOffset.x;\r\n                    position.y+=config.lastOffset.y;\r\n                }\r\n            }\r\n        }\r\n\r\n        return handCardsPos;\r\n    },\r\n    createHitCardPos(){//创建所有打出去的牌的位置\r\n        var posArray = new Array(this.posCount);\r\n        posArray[0] = {startPos:{x:170,y:70},offset:{x:-35,y:0},lineOffset:{x:0,y:42}};\r\n        posArray[1] = {startPos:{x:-180,y:150},offset:{x:0,y:-29},lineOffset:{x:-47,y:0}};\r\n        posArray[2] = {startPos:{x:-175,y:-80},offset:{x:35,y:0},lineOffset:{x:0,y:-41}};\r\n        posArray[3] = {startPos:{x:180,y:-150},offset:{x:0,y:29},lineOffset:{x:47,y:0}};\r\n        var hitCardsPos = new Array(this.posCount);\r\n\r\n        for(var pos=0;pos<this.posCount;pos++){\r\n            var cardPos = new Array(25);\r\n            hitCardsPos[pos] = cardPos;\r\n            for(var index=0;index<25;index++){\r\n                var position = cardPos[index] = {};\r\n                var config = posArray[pos];\r\n                var line = parseInt(index/10);\r\n                var lineIndex = index%10;\r\n                position.x = config.startPos.x + lineIndex * config.offset.x + config.lineOffset.x*line;\r\n                position.y = config.startPos.y + lineIndex * config.offset.y + config.lineOffset.y*line;\r\n            }\r\n        }\r\n            return hitCardsPos;\r\n    },\r\n\r\n    createGangPengCardPos(){\r\n        var posArray = new Array(this.posCount);\r\n        posArray[0] = {startPos:{x:294,y:208},offset:{x:-130,y:0}};\r\n        posArray[1] = {startPos:{x:-449,y:253},offset:{x:0,y:-98}};\r\n        posArray[2] = {startPos:{x:-576,y:-347},offset:{x:200,y:0}};\r\n        posArray[3] = {startPos:{x:455,y:-193},offset:{x:0,y:98}};\r\n        var gangpengPos = {};\r\n        for(var pos=0;pos<this.posCount;pos++){\r\n            var positions = gangpengPos[pos]=[];\r\n            for(var i=0;i<4;i++){\r\n                var position = {};\r\n                position.x = posArray[pos].startPos.x+posArray[pos].offset.x * i;\r\n                position.y = posArray[pos].startPos.y+posArray[pos].offset.y * i;\r\n                positions.push(position);\r\n            }\r\n        }\r\n        return gangpengPos;\r\n    },\r\n\r\n    createSplashPos(){\r\n        var posArray = new Array(this.posCount);\r\n        posArray[0] = {x:0,y:150};\r\n        posArray[1] = {x:-400,y:0};\r\n        posArray[2] = {x:0,y:-150};\r\n        posArray[3] = {x:400,y:0};\r\n        return posArray;\r\n    },\r\n\r\n    creatHandCardsUi(pos,cardIndex){\r\n        var pfb = this.handCardsPfb[pos];\r\n        var cardUi = cc.instantiate(pfb);\r\n        if(pos == 2){\r\n            //修改自己的牌\r\n            var sp = this.cardImages.getSpriteFrame(Majiang.smCard(cardIndex));\r\n            cardUi.getComponent(cc.Sprite).spriteFrame = sp;\r\n        }\r\n        return cardUi;\r\n    },\r\n    createHitCardsUi(pos,cardIndex){\r\n        var preStr =['h','l','h','r'];\r\n        var pfb = this.hitCardsPfb[pos];\r\n        var cardUi = cc.instantiate(pfb);\r\n        var sp = this.cardImages.getSpriteFrame(preStr[pos]+Majiang.smCard(cardIndex));\r\n        cardUi.getComponent(cc.Sprite).spriteFrame = sp;\r\n        return cardUi;\r\n    },\r\n    createGangPengCardUi(pos,cardIndex,type){//1 碰  2杠\r\n        var preStr =['h','l','h','r'];\r\n        var gangpengUi = cc.instantiate(this.gangpengPfb[pos]);\r\n        var cards = gangpengUi.children;\r\n        for(var i=0;i<cards.length;i++){\r\n            var card = cards[i];\r\n            var sp = this.cardImages.getSpriteFrame(preStr[pos]+Majiang.smCard(cardIndex));\r\n            card.getComponent(cc.Sprite).spriteFrame = sp;\r\n        }\r\n        type == 1?cards[3].active = false:cards[3].active=true;\r\n        return gangpengUi;\r\n    },\r\n    addGangPengCardUi(pos,cardIndex,type,index){\r\n        var count = 0;\r\n        for(var idx in this.gangpengCardsUi.children){\r\n            var ui = this.gangpengCardsUi.children[idx];\r\n            if(ui.meta.pos == pos)count+=1;\r\n        }\r\n        var gangpengUi = this.createGangPengCardUi(pos,cardIndex,type);\r\n        gangpengUi.meta = {};\r\n        gangpengUi.meta.tIndex = Majiang.tIndex(cardIndex);\r\n        gangpengUi.meta.pos = pos;\r\n        var position = this.gangpengCardsPos[pos][count];\r\n        gangpengUi.x = position.x;\r\n        gangpengUi.y = position.y;\r\n        pos==3?this.gangpengCardsUiBottom.addChild(gangpengUi):this.gangpengCardsUi.addChild(gangpengUi);\r\n    },\r\n    addHitCardUi(pos,cardIndex){\r\n        var cardUi = this.createHitCardsUi(pos,cardIndex);\r\n        var index = Object.keys(this.hitCards[pos]).length;\r\n        var position = this.hitCardsPos[pos][index];\r\n        cardUi.x = position.x;\r\n        cardUi.y = position.y;\r\n        var zIndex = 0;\r\n        if(pos==0 || pos==3){\r\n            zIndex = 25 - index;\r\n        }\r\n        if(pos==1 || pos==2){\r\n            zIndex = index;\r\n        }\r\n        cardUi.zIndex = zIndex;\r\n        this.hitCardUi.addChild(cardUi);\r\n        this.hitCards[pos][cardIndex] = {ui:cardUi,cardIndex:cardIndex};\r\n    },\r\n    addSplashUi(pos,type){\r\n        if(this.isRestore)return;\r\n        var map = {1:0,2:1,3:1,4:1,5:2,6:2};\r\n        var splashUi = cc.instantiate(this.actionSplashPfb);\r\n        splashUi.getComponent(cc.Sprite).spriteFrame = this.splashImages[map[type]];\r\n        var position = this.splashPos[pos];\r\n        splashUi.x = position.x;\r\n        splashUi.y = position.y;\r\n        this.splashUi.addChild(splashUi);\r\n        splashUi.getComponent(cc.Animation).on('finished',function () {\r\n            splashUi.removeFromParent(true);\r\n        });\r\n    },\r\n    getScreenPos(selfLogicPos,logicPos){\r\n        var myPos = selfLogicPos;\r\n        var delta = new Number(myPos) - 2;\r\n        var screenPos = new Number(logicPos) - delta;\r\n        screenPos =  screenPos<0?4+screenPos:screenPos;\r\n        screenPos =  screenPos>=4?screenPos-4:screenPos;\r\n        return screenPos;\r\n    },\r\n    showHead(pId,scrPos,imgUrl,name){\r\n        this.headRoot[scrPos].active = true;\r\n        var sp = this.headSpUi[scrPos].getComponent(cc.Sprite);\r\n        var nameLab = this.nameUi[scrPos].getComponent(cc.Label);\r\n        /*var frame = new cc.SpriteFrame();\r\n        frame.setTexture(imgUrl);\r\n        sp.spriteFrame = frame;*/\r\n        CreatorHelper.changeSpriteFrameWithServerUrl(sp,imgUrl);\r\n        nameLab.string = name;\r\n        var info = UnitTools.getOrCreateJsonInJson(pId,this.pInfos);\r\n        info.pos = scrPos; \r\n    },\r\n    hideHead(pId){\r\n        var info = this.pInfos[pId]  \r\n        if(UnitTools.isNullOrUndefined(info))return;\r\n        var pos = info.pos;\r\n        this.headRoot[pos].active = false;\r\n        this.nameUi[pos].getComponent(cc.Label).string = '';\r\n        this.scoreUi[pos].getComponent(cc.Label).string = '';\r\n    },\r\n    adjustSelfHandCard(){\r\n        var cardCount = 0;\r\n        for(var i=33;i>=0;i--){\r\n            var cards = this.selfHandCard[i];\r\n            for(var cardIndex in cards){\r\n                cardIndex = parseInt(cardIndex);\r\n                var ui = cards[cardIndex].ui;\r\n                var index = 12- cardCount;\r\n                cardCount+=1;\r\n                var pos = this.handCardsPos[2][index];\r\n                ui.x = pos.x;\r\n                ui.y=pos.y;\r\n            }\r\n        }\r\n    },\r\n    adjustHandCard(pos){\r\n        if(this.handCards[pos][13]!=null){\r\n            var card = this.handCards[pos][13];\r\n            for(var idx in this.handCards[pos]){\r\n                if(this.handCards[pos][idx]==null){\r\n                    this.handCards[pos][idx] = card;\r\n                    this.handCards[pos][13] = null;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        var handCards = this.handCards[pos];\r\n        var startIndex = 12;\r\n        for(var idx in handCards){\r\n            var card = handCards[idx];\r\n            if(card==null)continue;\r\n            var position = this.handCardsPos[pos][startIndex];\r\n            card.ui.x = position.x;\r\n            card.ui.y = position.y;\r\n            card.ui.zIndex = pos==3?12-startIndex:startIndex;\r\n            startIndex-=1;\r\n        }\r\n    },\r\n    touchCard(scrpos,cardIndex,type){\r\n        var cardUi = this.creatHandCardsUi(scrpos,cardIndex);\r\n        var pos = this.handCardsPos[scrpos][13];\r\n        cardUi.x = pos.x;cardUi.y = pos.y;\r\n        this.handCardsUi.addChild(cardUi);\r\n        var handCars = this.handCards[scrpos];\r\n        handCars[13] = {cardIndex:cardIndex,ui:cardUi};\r\n        if(type == 1){\r\n            var tIndex = Majiang.tIndex(cardIndex);\r\n            cc.log(tIndex);\r\n            cc.log(cardIndex);\r\n            this.selfHandCard[tIndex][cardIndex] = {ui:cardUi};\r\n            this.bindCardEvt(cardIndex,cardUi);\r\n        }\r\n    },\r\n    removeHandCardAndAdjust(pos,cardIndexs){//删除手里的牌并整理\r\n        var type = pos == 2?1:2;\r\n        for(var idx in cardIndexs){\r\n            var cardIndex = cardIndexs[idx];\r\n            if(type==1){\r\n                var tIndex = Majiang.tIndex(cardIndex);\r\n                var ui = this.selfHandCard[tIndex][cardIndex].ui;\r\n                ui.removeFromParent(true);\r\n                delete this.selfHandCard[tIndex][cardIndex];\r\n            }else if(type == 2){\r\n                var handCards = this.handCards[pos];\r\n                for(var idx in handCards){\r\n                    var card = handCards[idx];\r\n                    if(card==null)continue;\r\n                    card.ui.removeFromParent(true);\r\n                    handCards[idx]=null;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        type == 1?this.adjustSelfHandCard():this.adjustHandCard(pos);\r\n    },\r\n    turn(srcPos,time =20){\r\n        if(this.timeSche)this.unschedule(this.timeSche);\r\n        //point\r\n        var rotations = [180,90,0,-90];\r\n        this.TrunTime.active = true;\r\n        this.TrunTime.getChildByName('point').rotation = rotations[srcPos];\r\n        //timeout\r\n        this.TrunTime.getChildByName('text').getComponent(cc.Label).string = time;\r\n        this.timeSche = function () {\r\n            time-=1;\r\n            this.TrunTime.getChildByName('text').getComponent(cc.Label).string = time;\r\n        }.bind(this);\r\n        this.schedule(this.timeSche,1,19,0);\r\n    },\r\n    hitCard(scrPos,cardIndex,type){\r\n        this.addHitCardUi(scrPos,cardIndex);\r\n        if(type==1){\r\n            var tIndex = Majiang.tIndex(cardIndex);\r\n            var ui = this.selfHandCard[tIndex][cardIndex].ui;\r\n            ui.removeFromParent(true);\r\n            delete this.selfHandCard[tIndex][cardIndex];\r\n            this.adjustSelfHandCard();\r\n        }else if(type == 2){\r\n            var handCards = this.handCards[scrPos];\r\n            for(var idx in handCards){\r\n                var card = handCards[idx];\r\n                if(card==null)continue;\r\n                card.ui.removeFromParent(true);\r\n                handCards[idx]=null;\r\n                break;\r\n            }\r\n            this.adjustHandCard(scrPos);\r\n        }\r\n    },\r\n    bindCardEvt(cardIndex,cardUi){\r\n        var self = this;\r\n        cardUi.cardIndex = cardIndex;\r\n        cardUi.popUp = false;\r\n        CreatorHelper.setNodeClickEvent(cardUi,function () {\r\n            if(cardUi.popUp==true){\r\n                //出牌\r\n                cc.log('出牌:'+cardIndex);\r\n                NetWorkManager.onConnectedToGame(function (client) {\r\n                    var data = {};\r\n                    data.cardIndex = cardIndex;\r\n                    data.actionId = self.actionId;\r\n                    client.proxy.hitCard(data,function (data) {\r\n                        cc.log(data);\r\n\r\n                    });\r\n                });\r\n            }else{\r\n                //自己弹起其他牌下去\r\n                 \r\n                for(var tIndex in this.selfHandCard){\r\n                    var cards = this.selfHandCard[tIndex];\r\n                    for(var cIdx in cards){\r\n                        var ui = cards[cIdx].ui;\r\n                        if(!ui.popUp)continue;\r\n                        ui.y-=40;\r\n                        ui.popUp =false;\r\n                    }\r\n                }\r\n                cardUi.y +=40;\r\n                cardUi.popUp =true;\r\n            }\r\n        }.bind(this));\r\n    },\r\n    showActionSelectUi(actions){\r\n        var self = this;\r\n        var selectAction = function (actionType,cardIndex) {\r\n            NetWorkManager.onConnectedToGame(function (client) {\r\n                var data = {};\r\n                data.actionType = actionType;\r\n                data.cardIndex = cardIndex;\r\n                data.actionId = self.actionId;\r\n                client.proxy.selectAction(data,function (data) {\r\n                    cc.log('选择结果');\r\n                    cc.log(data);\r\n                    self.selectActionUi.removeAllChildren(true);\r\n                });\r\n            });\r\n        }\r\n        this.selectActionUi.active = true;\r\n        this.selectActionUi.removeAllChildren(true);\r\n        var map={1:1,2:2,3:2,4:2,5:3,6:3}; \r\n        //添加\"过\"\r\n        var passUi = cc.instantiate(this.actionSelectPfb);\r\n        passUi.getComponent(cc.Sprite).spriteFrame = this.actionImages[0];\r\n        passUi.getChildByName('card').active = false;\r\n        this.selectActionUi.addChild(passUi);\r\n        CreatorHelper.setNodeClickEvent(passUi,function () {\r\n            cc.log('Pass选择了Action:');\r\n            cc.log('Pass actionType:'+0);\r\n            cc.log('Pass tIndex:'+0);\r\n            selectAction(0,0);\r\n        });\r\n\r\n        //-//\r\n        for(var actionType in actions){\r\n            var action = actions[actionType];\r\n            var details = [];\r\n            if(!(action instanceof Array)){\r\n                details.push(action);\r\n            }else{\r\n                details=action;\r\n            }\r\n            for(var idx in details){\r\n                var detail = details[idx];\r\n                var cardIndex = detail.cardIndex;\r\n                var selectUi = cc.instantiate(this.actionSelectPfb);\r\n                //修改图标，麻将\r\n                selectUi.getComponent(cc.Sprite).spriteFrame = this.actionImages[map[actionType]];\r\n                selectUi.getChildByName('card').getComponent(cc.Sprite).spriteFrame = this.cardImages.getSpriteFrame(Majiang.smCard(cardIndex));\r\n                this.selectActionUi.addChild(selectUi);\r\n                CreatorHelper.setNodeClickEvent(selectUi,function (actionType,cardIndex) {\r\n                    cc.log('选择了Action:');\r\n                    cc.log('actionType:'+actionType);\r\n                    cc.log('cardIndexxxxxxx:'+this.cardImages.getSpriteFrame(Majiang.smCard(cardIndex)));\r\n                    selectAction(actionType,cardIndex);\r\n                }.bind(this,actionType,cardIndex));\r\n\r\n            }\r\n        }\r\n    },\r\n    handledoAction(data){\r\n        this.selectActionUi.active = false;\r\n        var actionType=data.actionType;\r\n        var pos = data.pos;\r\n        var hitPos = data.hitPos;\r\n        var cardIndex = data.hitIndex;\r\n        var cardIndexs = data.cardIndexs;\r\n        var srcPos = this.getScreenPos(User.pos,pos);//屏幕位置\r\n        var hitScrPos = this.getScreenPos(User.pos,hitPos);//打牌人的屏幕位置\r\n        if(actionType == HandAction.Peng){//处理碰\r\n            this.addSplashUi(srcPos,actionType);\r\n            var hitUi = this.hitCards[hitScrPos][cardIndex].ui;\r\n            hitUi.removeFromParent(true);\r\n            delete this.hitCards[hitScrPos][cardIndex];\r\n            this.removeHandCardAndAdjust(srcPos,cardIndexs);\r\n            this.addGangPengCardUi(srcPos,cardIndex,actionType,this.gangpengCardsUi.children.length);\r\n        }else if(actionType == HandAction.AnGang){//处理暗杠\r\n            var cardIndex = data.cardIndex;\r\n            this.addSplashUi(srcPos,actionType);\r\n            this.removeHandCardAndAdjust(srcPos,cardIndexs);\r\n            this.addGangPengCardUi(srcPos,cardIndex,actionType,this.gangpengCardsUi.children.length);\r\n        }else if(actionType == HandAction.MingGang){//处理明杠\r\n            this.addSplashUi(srcPos,actionType);\r\n            var hitUi = this.hitCards[hitScrPos][cardIndex].ui;\r\n            hitUi.removeFromParent(true);\r\n            delete this.hitCards[hitScrPos][cardIndex];\r\n            this.removeHandCardAndAdjust(srcPos,cardIndexs);\r\n            this.addGangPengCardUi(srcPos,cardIndex,actionType,this.gangpengCardsUi.children.length);\r\n        }else if(actionType == HandAction.GuoluGang){\r\n            var cardIndex = data.cardIndex;\r\n            var uis = this.gangpengCardsUi.children;\r\n            this.addSplashUi(srcPos,actionType);\r\n            this.removeHandCardAndAdjust(srcPos,cardIndexs);\r\n            for(var idx in uis){\r\n                var ui = uis[idx];\r\n                if(ui.meta.tIndex == Majiang.tIndex(cardIndex)){\r\n                    ui.children[3].active = true;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    },\r\n    handlehu(data){\r\n        this.selectActionUi.removeAllChildren(true);\r\n        this.selectActionUi.destroyAllChildren();\r\n        var posHuType = data.posHuType;\r\n        for(var pos in posHuType){\r\n            var srcPos = this.getScreenPos(User.pos,pos);//屏幕位置\r\n            var actionType = posHuType[pos];\r\n            this.addSplashUi(srcPos,actionType);//显示出胡牌 \r\n        }\r\n        this.scheduleOnce(function () {\r\n            this.showGameScore(data.zhuangPos,data.posHuType,data.paoPos,\r\n                data.score,data.posName,data.huCardIndex,\r\n                data.posHandCards,data.posActionCards)\r\n        }.bind(this),2);\r\n    },\r\n    showGameScore(zhuangPos,huPosAndType,paoPos,posScore,posNames,huCardIndex,posHandCards,posActionCards){\r\n        var self = this;\r\n        var addStyle = function (styleRoot,styleName) {\r\n            var biaoqianNode = cc.instantiate(this.scorebqPfb);\r\n            styleRoot.addChild(biaoqianNode);\r\n            var nameNode = cc.find(\"name\",biaoqianNode);\r\n            nameNode.getComponent(cc.Label).string = styleName;\r\n        }.bind(this);\r\n\r\n        var scoreUi = cc.instantiate(this.gameScorePfb);\r\n        this.node.addChild(scoreUi);\r\n        var titleNode = cc.find('title',scoreUi);\r\n        if(Object.keys(huPosAndType).length==0){//流局\r\n            titleNode.getComponent(cc.Sprite).spriteFrame = this.titleMask[0];\r\n        }else if(posScore[User.pos] > 0){\r\n            titleNode.getComponent(cc.Sprite).spriteFrame = this.titleMask[1];\r\n        }else if(posScore[User.pos] <= 0){\r\n            titleNode.getComponent(cc.Sprite).spriteFrame = this.titleMask[2];\r\n        }\r\n        var scoreItemsNode = cc.find('scoreitems',scoreUi);\r\n        scoreItemsNode.removeAllChildren(true);\r\n        scoreItemsNode.destroyAllChildren();\r\n\r\n        for(var pos=0;pos<this.posCount;pos++){\r\n            var scrPos = this.getScreenPos(User.pos,pos);\r\n            var scoreItem = cc.instantiate(this.scoreItemPfb);\r\n            scoreItemsNode.addChild(scoreItem);\r\n            var zhuangNode = cc.find('zhuang',scoreItem);\r\n            zhuangNode.active = false;\r\n\r\n            if(pos == zhuangPos)zhuangNode.active = true;//显示庄\r\n\r\n            var nameNode = cc.find('name',scoreItem);\r\n            nameNode.getComponent(cc.Label).string = posNames[pos];//显示名字\r\n            var scoreNode = cc.find('score',scoreItem);\r\n            scoreNode.getComponent(cc.Label).string = posScore[pos];//显示分数\r\n            var huMaskNode = cc.find('humask',scoreItem);\r\n            huMaskNode.active = false;\r\n            var styleNode = cc.find('style',scoreItem);\r\n            styleNode.destroyAllChildren();\r\n            var huType = huPosAndType[pos];\r\n\r\n            if(!UnitTools.isNullOrUndefined(huType)){//显示胡标签\r\n                var styleName = huType == 5?'接炮':'自摸';\r\n                addStyle(styleNode,styleName);\r\n                huMaskNode.active = true;\r\n            }else if(paoPos!=null && paoPos==pos)addStyle(styleNode,'点炮');\r\n\r\n            var actionTimes = {};\r\n            var addActionTime = function (pos,actionType) {\r\n                if(UnitTools.isNullOrUndefined(actionTimes[pos]))actionTimes[pos] = {};\r\n                if(UnitTools.isNullOrUndefined(actionTimes[pos][actionType]))actionTimes[pos][actionType] = 0;\r\n                actionTimes[pos][actionType] +=1;\r\n            }\r\n\r\n            var actionCards = posActionCards[pos];\r\n            var handCards = posHandCards[pos]; \r\n            var cardStartX = 0;//结算页面牌的起始位置*\r\n            var cardOffset = 55;//普通牌的偏移量*\r\n            var pengOffset = 185;//碰牌的偏移量*\r\n            var gangOffset = 225;//杠牌的偏移量*\r\n            var huCardOffset = 20;//最后胡的牌的偏移量*\r\n\r\n            var mjrootNode = cc.find('mjroot',scoreItem);\r\n            mjrootNode.destroyAllChildren();\r\n\r\n            for(var idx in actionCards){\r\n                var acards = actionCards[idx];\r\n                var actionType = idx;\r\n                var cardIndex = Majiang.cards[acards.tIndex];\r\n                var hitPos = acards.hitPos;\r\n\r\n                if(actionType==HandAction.Peng){//显示碰\r\n                    for(var count=0;count<3;count++){\r\n                        var cardUi = this.createHitCardsUi(2,cardIndex);                  \r\n                        cardUi.x = -12;            \r\n                        cardUi.y = 60;\r\n                        cardUi.scale = 1;\r\n                        mjrootNode.addChild(cardUi);\r\n                        cardUi.x+=cardStartX+cardOffset * count;\r\n                    }\r\n                    cardStartX+=pengOffset\r\n                }else if(actionType==HandAction.AnGang){//显示杠\r\n                    for(var count=0;count<4;count++){\r\n                        var cardUi = this.createHitCardsUi(2,cardIndex);                  \r\n                        cardUi.x = -12;            \r\n                        cardUi.y = 60;\r\n                        cardUi.scale = 1;\r\n                        mjrootNode.addChild(cardUi);\r\n                        cardUi.x+=cardStartX+cardOffset * count;\r\n                    }\r\n                    addActionTime(pos,HandAction.AnGang);\r\n                    cardStartX+=gangOffset\r\n                }else if(actionType==HandAction.MingGang){\r\n                    for(var count=0;count<4;count++){\r\n                        var cardUi = this.createHitCardsUi(2,cardIndex);                  \r\n                        cardUi.x = -12;            \r\n                        cardUi.y = 60;\r\n                        cardUi.scale = 1;\r\n                        mjrootNode.addChild(cardUi);\r\n                        cardUi.x+=cardStartX+cardOffset * count;\r\n                    }\r\n                    addActionTime(hitPos,HandAction.MingGang);\r\n                    addActionTime(pos,HandAction.MingGang);\r\n                    cardStartX+=gangOffset\r\n                }else if(actionType==HandAction.GuoluGang){\r\n                    for(var count=0;count<4;count++){\r\n                        var cardUi = this.createHitCardsUi(2,cardIndex);                  \r\n                        cardUi.x = -12;            \r\n                        cardUi.y = 60;\r\n                        cardUi.scale = 1;\r\n                        mjrootNode.addChild(cardUi);\r\n                        cardUi.x+=cardStartX+cardOffset * count;\r\n                    }\r\n                    addActionTime(hitPos,0);\r\n                    addActionTime(pos,HandAction.GuoluGang);\r\n                    cardStartX+=gangOffset\r\n                }\r\n            }\r\n\r\n\r\n            var count = 0;\r\n            delete handCards[huCardIndex];\r\n\r\n            for(var cardIndex in handCards){//显示手牌\r\n                var cardUi = this.createHitCardsUi(2,cardIndex);                  \r\n                cardUi.x = -12;            \r\n                cardUi.y = 60;\r\n                cardUi.scale = 1;\r\n                mjrootNode.addChild(cardUi);\r\n                cardUi.x+=cardStartX;\r\n                cardStartX+=cardOffset;\r\n                count+=1;\r\n            }\r\n\r\n            if(!UnitTools.isNullOrUndefined(huType)){//自己胡了\r\n                var cardUi = this.createHitCardsUi(2,huCardIndex);                  \r\n                cardUi.x = -12;            \r\n                cardUi.y = 60;\r\n                cardUi.scale = 1;\r\n                mjrootNode.addChild(cardUi);\r\n                cardUi.x+=cardStartX+huCardOffset;\r\n                var hbqUi = cc.instantiate(this.cardhuPfb);\r\n                mjrootNode.addChild(hbqUi);\r\n                hbqUi.x += cardStartX+huCardOffset;\r\n            }\r\n        }\r\n        for(var pos=0;pos<this.posCount;pos++){\r\n            var aTimeNode = cc.find('actiontimes',scoreItemsNode.children[pos]);//动作次数\r\n            aTimeNode.getComponent(cc.Label).string = '';\r\n            var aTimeName = {0:'点杠',2:'暗杠',3:'明杠',4:'过路杠'};\r\n            var aTimes = actionTimes[pos];\r\n    \r\n            for(var aType in aTimes){//动作次数\r\n                var aTName = aTimeName[aType];\r\n                var aTime = aTimes[aType];\r\n                aTimeNode.getComponent(cc.Label).string += aTName+'×'+aTime+' ';\r\n            }\r\n        }\r\n\r\n        //添加点击继续时间\r\n        var goonbn = scoreUi.getChildByName('goonbn');\r\n        CreatorHelper.setNodeClickEvent(goonbn,function () {\r\n            scoreUi.removeFromParent(true);\r\n            //delete scoreUi;\r\n            if(self.raceScore == null){//继续游戏\r\n                self.clearToContinue();\r\n                NetWorkManager.onConnectedToGame(function (client) {\r\n                    client.proxy.ready(true,function (data) {\r\n                        cc.log(data);\r\n\r\n                    });\r\n                });\r\n            }else{//结束了\r\n                self.showFinalScore(self.raceScore.posScores,self.raceScore.posNames);\r\n\r\n            }\r\n        });\r\n    },\r\n    showFinalScore(posScores,posNameAndHeadUrl){\r\n        var finalScoreUi = cc.instantiate(this.finalScorePfb);\r\n        this.node.addChild(finalScoreUi);\r\n        var detailsUi = cc.find('details',finalScoreUi);\r\n        detailsUi.removeAllChildren(true);\r\n        detailsUi.destroyAllChildren();\r\n        for(var pos in posScores){\r\n            var scores = posScores[pos];\r\n            var name = posNameAndHeadUrl[pos].name;\r\n            var headUrl = posNameAndHeadUrl[pos].headUrl;\r\n            var scoreItemUi = cc.instantiate(this.finalScoreItemPfb);\r\n            detailsUi.addChild(scoreItemUi);\r\n            var headSp = cc.find('head',scoreItemUi).getComponent(cc.Sprite);\r\n            CreatorHelper.changeSpriteFrameWithServerUrl(headSp,headUrl);\r\n            var nameLab = cc.find('name',scoreItemUi).getComponent(cc.Label);\r\n            nameLab.string = name;\r\n            var allScore = 0;\r\n            var scoresUi = cc.find('detailscroll/view/content',scoreItemUi);\r\n            scoresUi.removeAllChildren(true);\r\n            scoresUi.destroyAllChildren();\r\n\r\n            for(var idx in scores){\r\n                var score = scores[idx];\r\n                var scoreUi = cc.instantiate(this.finScoreDetailPfb);\r\n                scoresUi.addChild(scoreUi);\r\n                scoreUi.getComponent(cc.Label).string = (parseInt(idx)+1)+'round: '+score;\r\n                allScore+=score;\r\n            }\r\n\r\n            var finalScoreUi = cc.find('score',scoreItemUi);\r\n            finalScoreUi.getComponent(cc.Label).string = allScore;\r\n            User.score = allScore;\r\n        }\r\n    },\r\n    showRoomId(roomId){\r\n        var roomIdLab = cc.find('roomid',this.node).getComponent(cc.Label);\r\n        roomIdLab.string = 'Room Number: '+roomId;\r\n    },\r\n    normalStart(){\r\n        var self = this;\r\n        var inRoomInfo = User.loginToGameData.inRoomInfo;\r\n        cc.log(\"gameLogic->normalStart->loginToGameData: %o\",User.loginToGameData);\r\n        var heads = inRoomInfo.heads;\r\n        User.playerId = inRoomInfo.playerId;\r\n        User.pos = inRoomInfo.pos;\r\n        UnitTools.forEach(heads,function (pos,pInfo) {\r\n            self.showHead(pInfo.playerId,self.getScreenPos(User.pos,pos),pInfo.headimgUrl,pInfo.nickName);\r\n        });\r\n\r\n        this.showRoomId(inRoomInfo.roomId);\r\n\r\n        var frames = inRoomInfo.frames;\r\n        for(var idx in frames){\r\n            this.isRestore = true;//表示当前处于短线重连中\r\n            var frame = frames[idx];\r\n            Handler.instance()['handle'+frame.eventName](frame.data);\r\n\r\n        }\r\n        this.isRestore = false;\r\n    },\r\n    start () {\r\n        this.normalStart();\r\n        //cc.log('Player Info: ',this.pInfos);\r\n        //cc.log('Player Info2 %o: ',User.account);\r\n        //this.test();\r\n    },\r\n\r\n    test(){\r\n        //----------------------------头像测试\r\n        this.showHead(2,0,\"http://i4.fuimg.com/583278/00e2ef22ec67b9b0.jpg\",\"鸡蛋\");\r\n        this.showHead(3,1,\"http://i4.fuimg.com/583278/00e2ef22ec67b9b0.jpg\",\"鸡蛋\");\r\n        this.showHead(4,2,\"http://i4.fuimg.com/583278/00e2ef22ec67b9b0.jpg\",\"鸡蛋\");\r\n        this.showHead(5,3,\"http://i4.fuimg.com/583278/00e2ef22ec67b9b0.jpg\",\"鸡蛋\");\r\n        //---------------------------牌测试\r\n        for(var i=0;i<14;i++){\r\n            var cardIndex = Majiang.cards[i];\r\n            var cardUi = this.creatHandCardsUi(2,cardIndex);\r\n            var pos = this.handCardsPos[2][i];\r\n            cardUi.x = pos.x;\r\n            cardUi.y=pos.y;\r\n            this.handCardsUi.addChild(cardUi);\r\n            var tIndex = Majiang.tIndex(cardIndex);\r\n            this.selfHandCard[tIndex][''+cardIndex]={ui:cardUi};\r\n            this.bindCardEvt(cardIndex,cardUi);\r\n\r\n\r\n            var cardUi = this.creatHandCardsUi(0,19);\r\n            var pos = this.handCardsPos[0][i];\r\n            cardUi.x = pos.x;\r\n            cardUi.y=pos.y;\r\n            this.handCardsUi.addChild(cardUi);\r\n\r\n            var cardUi = this.creatHandCardsUi(1,19);\r\n            var pos = this.handCardsPos[1][i];\r\n            cardUi.x = pos.x;\r\n            cardUi.y=pos.y;\r\n            this.handCardsUi.addChild(cardUi);\r\n\r\n            var cardUi = this.creatHandCardsUi(3,19);\r\n            var pos = this.handCardsPos[3][i];\r\n            cardUi.x = pos.x;\r\n            cardUi.y=pos.y;\r\n            cardUi.zIndex = 14-i;\r\n            //this.node.zIndex = i;\r\n            this.handCardsUi.addChild(cardUi);\r\n        }\r\n        //---------------------------出牌测试\r\n        for(var i=0;i<25;i++){\r\n            var randomIndex = UnitTools.random(0,Majiang.cards.length-1);\r\n            var cardIndex = Majiang.cards[randomIndex];\r\n            for(var pos=0;pos<this.posCount;pos++){\r\n                this.addHitCardUi(pos,cardIndex);\r\n            }\r\n        }\r\n        //---------------------------action选择测试\r\n        var actions = {};\r\n        actions[1] = {pos:2,cardIndex:61};\r\n        actions[2] = [{pos:2,cardIndex:61},{pos:2,cardIndex:61}];\r\n        this.showActionSelectUi(actions);\r\n        //-------------杠碰牌测试\r\n        for(var pos=0;pos<4;pos++){\r\n            for(var i=0;i<4;i++){\r\n                var randomIndex = UnitTools.random(0,Majiang.cards.length-1);\r\n                var cardIndex = Majiang.cards[randomIndex];\r\n                cc.log(\"randomIndex: \"+randomIndex);\r\n                this.addGangPengCardUi(pos,randomIndex,2,i);\r\n            }\r\n        }\r\n        //--------------splash test\r\n        for(var pos =0;pos<4;pos++){\r\n            this.addSplashUi(pos,1);\r\n        }\r\n        //---------------结算页面测试\r\n        User.pos = 2;\r\n        var zhuangPos = 2;\r\n        var huPosAndType = {2:5};\r\n        var paoPos = 3;\r\n        var posScores = {0:0,1:0,2:2,3:-2};\r\n        var posName = {0:\"李鸡蛋0\",1:\"李鸡蛋1\",2:\"李鸡蛋2\",3:\"李鸡蛋3\"};\r\n        var posHandCards = {\r\n            0:{ 11:1,12:1,13:1,14:1,15:1,16:1,17:1,18:1,19:1},\r\n            1:{ 11:1,12:1,13:1,14:1,15:1,16:1,17:1,18:1},\r\n            2:{ 11:1,12:1,13:1,14:1,15:1,16:1,17:1,18:1,19:1,21:1,22:1,23:1},\r\n            3:{ 11:1,12:1,13:1,14:1,15:1,16:1,17:1,18:1}\r\n        }\r\n        var posActionCards = {\r\n            0:{1:{tIndex:17}},\r\n            1:{3:{tIndex:18,hitPos:2}},\r\n            3:{4:{tIndex:19,hitPos:1}}\r\n        };\r\n\r\n        //this.showGameScore(zhuangPos,huPosAndType,paoPos,posScores,posName,41,posHandCards,posActionCards);\r\n    //---------------最终分数显示---------------------\r\n    var posScores = {0:[0,1,2,3,4,5,6,7,8],1:[0,1,2,3,4,5,6,7,8],2:[0,1,2,3,4,5,6,7,8],3:[0,1,2,3,4,5,6,7,8]}\r\n    var posName = {0:{name:\"李鸡蛋0\",headUrl:\"http://i4.fuimg.com/583278/00e2ef22ec67b9b0.jpg\"},\r\n        1:{name:\"李鸡蛋1\",headUrl:\"http://i4.fuimg.com/583278/00e2ef22ec67b9b0.jpg\"},\r\n        2:{name:\"李鸡蛋2\",headUrl:\"http://i4.fuimg.com/583278/00e2ef22ec67b9b0.jpg\"},\r\n        3:{name:\"李鸡蛋3\",headUrl:\"http://i4.fuimg.com/583278/00e2ef22ec67b9b0.jpg\"}};\r\n    //this.showFinalScore(posScores,posName);\r\n\r\n    this.clearToContinue();\r\n    },\r\n    update (dt) {\r\n        for(var idx in Handler.instance().eventQueue){\r\n            var frame = Handler.instance().eventQueue[idx];\r\n            Handler.instance()['handle'+frame.eventName](frame.data);\r\n        }\r\n        Handler.instance().eventQueue = [];\r\n    },\r\n    onDestroy(){\r\n        NetWorkManager.offClosedFromGame(this.onClose.bind(this));\r\n        NetWorkManager.clearGameService();\r\n    }\r\n});\r\n"]}